"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
self["webpackHotUpdate_N_E"]("src/middleware",{

/***/ "(middleware)/./src/middleware.js":
/*!***************************!*\
  !*** ./src/middleware.js ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   middleware: () => (/* binding */ middleware)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(middleware)/./node_modules/next/dist/esm/api/server.js\");\n/* harmony import */ var jose__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! jose */ \"(middleware)/./node_modules/jose/dist/browser/index.js\");\n\n\nconst JWT_SECRET = new TextEncoder().encode(process.env.JWT_SECRET || 'supersecretkey');\nasync function middleware(req) {\n    const authHeader = req.headers.get('authorization');\n    if (!authHeader) {\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: 'Unauthorized - Missing Token'\n        }, {\n            status: 401\n        });\n    }\n    const token = authHeader.split(' ')[1];\n    if (!token) {\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: 'Unauthorized - Invalid Token Format'\n        }, {\n            status: 401\n        });\n    }\n    try {\n        const { payload } = await (0,jose__WEBPACK_IMPORTED_MODULE_1__.jwtVerify)(token, JWT_SECRET, {\n            algorithms: [\n                'HS256'\n            ]\n        });\n        const { role, userId, businessId } = payload;\n        const url = req.nextUrl.pathname;\n        if (!role) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: 'Unauthorized - Role not found in token'\n            }, {\n                status: 401\n            });\n        }\n        // ✅ Доступ для /api/admin\n        if (url.startsWith('/api/admin')) {\n            if (role !== 'ADMIN') {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    error: 'Access Denied: Admins only'\n                }, {\n                    status: 403\n                });\n            }\n        }\n        // ✅ Доступ для /api/chatbots\n        if (url.startsWith('/api/chatbots')) {\n            if ([\n                'POST',\n                'PUT',\n                'DELETE'\n            ].includes(req.method)) {\n                // Создание, обновление, удаление – ADMIN и BO\n                if (![\n                    'ADMIN',\n                    'BO'\n                ].includes(role)) {\n                    return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                        error: 'Access Denied: Only admins or BO can manage chatbots'\n                    }, {\n                        status: 403\n                    });\n                }\n            }\n            if (req.method === 'GET') {\n                // ADMIN – видит всех\n                if (role === 'ADMIN') {\n                    return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.next();\n                }\n                // BO – видит только чат-боты своего бизнеса\n                if (role === 'BO') {\n                    req.headers.set('x-filter-business', businessId); // Передаем бизнес-ID для фильтрации в API\n                    return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.next();\n                }\n                // BE – видит чат-боты бизнеса, к которому он прикреплен\n                if (role === 'BE') {\n                    req.headers.set('x-filter-employee-business', businessId); // Фильтр для BE\n                    return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.next();\n                }\n                // GUEST – нет доступа\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    error: 'Access Denied: Guests cannot access chatbots'\n                }, {\n                    status: 403\n                });\n            }\n        }\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.next();\n    } catch (error) {\n        console.error('JWT Verification Error:', error.message);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: 'Invalid or expired token'\n        }, {\n            status: 401\n        });\n    }\n}\n// ✅ Конфигурация маршрутов\nconst config = {\n    matcher: [\n        '/api/admin/:path*',\n        '/api/business/:path*',\n        '/api/modules/:path*',\n        '/api/chatbots/:path*'\n    ]\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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WSxJQUFJLENBQUM7WUFBRUMsT0FBTztRQUEyQixHQUFHO1lBQUVDLFFBQVE7UUFBSTtJQUNoRjtBQUNGO0FBRUEsMkJBQTJCO0FBQ3BCLE1BQU1rQixTQUFTO0lBQ3BCQyxTQUFTO1FBQ1A7UUFDQTtRQUNBO1FBQ0E7S0FDRDtBQUNILEVBQUUiLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcZ3JlZ2VcXERlc2t0b3BcXFBhbmVsa2FcXHNyY1xcbWlkZGxld2FyZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBOZXh0UmVzcG9uc2UgfSBmcm9tICduZXh0L3NlcnZlcic7XHJcbmltcG9ydCB7IGp3dFZlcmlmeSB9IGZyb20gJ2pvc2UnO1xyXG5cclxuY29uc3QgSldUX1NFQ1JFVCA9IG5ldyBUZXh0RW5jb2RlcigpLmVuY29kZShcclxuICBwcm9jZXNzLmVudi5KV1RfU0VDUkVUIHx8ICdzdXBlcnNlY3JldGtleSdcclxuKTtcclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBtaWRkbGV3YXJlKHJlcSkge1xyXG4gIGNvbnN0IGF1dGhIZWFkZXIgPSByZXEuaGVhZGVycy5nZXQoJ2F1dGhvcml6YXRpb24nKTtcclxuXHJcbiAgaWYgKCFhdXRoSGVhZGVyKSB7XHJcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBlcnJvcjogJ1VuYXV0aG9yaXplZCAtIE1pc3NpbmcgVG9rZW4nIH0sIHsgc3RhdHVzOiA0MDEgfSk7XHJcbiAgfVxyXG5cclxuICBjb25zdCB0b2tlbiA9IGF1dGhIZWFkZXIuc3BsaXQoJyAnKVsxXTtcclxuXHJcbiAgaWYgKCF0b2tlbikge1xyXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6ICdVbmF1dGhvcml6ZWQgLSBJbnZhbGlkIFRva2VuIEZvcm1hdCcgfSwgeyBzdGF0dXM6IDQwMSB9KTtcclxuICB9XHJcblxyXG4gIHRyeSB7XHJcbiAgICBjb25zdCB7IHBheWxvYWQgfSA9IGF3YWl0IGp3dFZlcmlmeSh0b2tlbiwgSldUX1NFQ1JFVCwge1xyXG4gICAgICBhbGdvcml0aG1zOiBbJ0hTMjU2J10sXHJcbiAgICB9KTtcclxuICAgIGNvbnN0IHsgcm9sZSwgdXNlcklkLCBidXNpbmVzc0lkIH0gPSBwYXlsb2FkO1xyXG4gICAgY29uc3QgdXJsID0gcmVxLm5leHRVcmwucGF0aG5hbWU7XHJcblxyXG4gICAgaWYgKCFyb2xlKSB7XHJcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGVycm9yOiAnVW5hdXRob3JpemVkIC0gUm9sZSBub3QgZm91bmQgaW4gdG9rZW4nIH0sIHsgc3RhdHVzOiA0MDEgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8g4pyFINCU0L7RgdGC0YPQvyDQtNC70Y8gL2FwaS9hZG1pblxyXG4gICAgaWYgKHVybC5zdGFydHNXaXRoKCcvYXBpL2FkbWluJykpIHtcclxuICAgICAgaWYgKHJvbGUgIT09ICdBRE1JTicpIHtcclxuICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBlcnJvcjogJ0FjY2VzcyBEZW5pZWQ6IEFkbWlucyBvbmx5JyB9LCB7IHN0YXR1czogNDAzIH0pO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLy8g4pyFINCU0L7RgdGC0YPQvyDQtNC70Y8gL2FwaS9jaGF0Ym90c1xyXG4gICAgaWYgKHVybC5zdGFydHNXaXRoKCcvYXBpL2NoYXRib3RzJykpIHtcclxuICAgICAgaWYgKFsnUE9TVCcsICdQVVQnLCAnREVMRVRFJ10uaW5jbHVkZXMocmVxLm1ldGhvZCkpIHtcclxuICAgICAgICAvLyDQodC+0LfQtNCw0L3QuNC1LCDQvtCx0L3QvtCy0LvQtdC90LjQtSwg0YPQtNCw0LvQtdC90LjQtSDigJMgQURNSU4g0LggQk9cclxuICAgICAgICBpZiAoIVsnQURNSU4nLCAnQk8nXS5pbmNsdWRlcyhyb2xlKSkge1xyXG4gICAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6ICdBY2Nlc3MgRGVuaWVkOiBPbmx5IGFkbWlucyBvciBCTyBjYW4gbWFuYWdlIGNoYXRib3RzJyB9LCB7IHN0YXR1czogNDAzIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG5cclxuICAgICAgaWYgKHJlcS5tZXRob2QgPT09ICdHRVQnKSB7XHJcbiAgICAgICAgLy8gQURNSU4g4oCTINCy0LjQtNC40YIg0LLRgdC10YVcclxuICAgICAgICBpZiAocm9sZSA9PT0gJ0FETUlOJykge1xyXG4gICAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5uZXh0KCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBCTyDigJMg0LLQuNC00LjRgiDRgtC+0LvRjNC60L4g0YfQsNGCLdCx0L7RgtGLINGB0LLQvtC10LPQviDQsdC40LfQvdC10YHQsFxyXG4gICAgICAgIGlmIChyb2xlID09PSAnQk8nKSB7XHJcbiAgICAgICAgICByZXEuaGVhZGVycy5zZXQoJ3gtZmlsdGVyLWJ1c2luZXNzJywgYnVzaW5lc3NJZCk7IC8vINCf0LXRgNC10LTQsNC10Lwg0LHQuNC30L3QtdGBLUlEINC00LvRjyDRhNC40LvRjNGC0YDQsNGG0LjQuCDQsiBBUElcclxuICAgICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UubmV4dCgpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gQkUg4oCTINCy0LjQtNC40YIg0YfQsNGCLdCx0L7RgtGLINCx0LjQt9C90LXRgdCwLCDQuiDQutC+0YLQvtGA0L7QvNGDINC+0L0g0L/RgNC40LrRgNC10L/Qu9C10L1cclxuICAgICAgICBpZiAocm9sZSA9PT0gJ0JFJykge1xyXG4gICAgICAgICAgcmVxLmhlYWRlcnMuc2V0KCd4LWZpbHRlci1lbXBsb3llZS1idXNpbmVzcycsIGJ1c2luZXNzSWQpOyAvLyDQpNC40LvRjNGC0YAg0LTQu9GPIEJFXHJcbiAgICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLm5leHQoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIEdVRVNUIOKAkyDQvdC10YIg0LTQvtGB0YLRg9C/0LBcclxuICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBlcnJvcjogJ0FjY2VzcyBEZW5pZWQ6IEd1ZXN0cyBjYW5ub3QgYWNjZXNzIGNoYXRib3RzJyB9LCB7IHN0YXR1czogNDAzIH0pO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5uZXh0KCk7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0pXVCBWZXJpZmljYXRpb24gRXJyb3I6JywgZXJyb3IubWVzc2FnZSk7XHJcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBlcnJvcjogJ0ludmFsaWQgb3IgZXhwaXJlZCB0b2tlbicgfSwgeyBzdGF0dXM6IDQwMSB9KTtcclxuICB9XHJcbn1cclxuXHJcbi8vIOKchSDQmtC+0L3RhNC40LPRg9GA0LDRhtC40Y8g0LzQsNGA0YjRgNGD0YLQvtCyXHJcbmV4cG9ydCBjb25zdCBjb25maWcgPSB7XHJcbiAgbWF0Y2hlcjogW1xyXG4gICAgJy9hcGkvYWRtaW4vOnBhdGgqJyxcclxuICAgICcvYXBpL2J1c2luZXNzLzpwYXRoKicsXHJcbiAgICAnL2FwaS9tb2R1bGVzLzpwYXRoKicsXHJcbiAgICAnL2FwaS9jaGF0Ym90cy86cGF0aConXHJcbiAgXSxcclxufTtcclxuIl0sIm5hbWVzIjpbIk5leHRSZXNwb25zZSIsImp3dFZlcmlmeSIsIkpXVF9TRUNSRVQiLCJUZXh0RW5jb2RlciIsImVuY29kZSIsInByb2Nlc3MiLCJlbnYiLCJtaWRkbGV3YXJlIiwicmVxIiwiYXV0aEhlYWRlciIsImhlYWRlcnMiLCJnZXQiLCJqc29uIiwiZXJyb3IiLCJzdGF0dXMiLCJ0b2tlbiIsInNwbGl0IiwicGF5bG9hZCIsImFsZ29yaXRobXMiLCJyb2xlIiwidXNlcklkIiwiYnVzaW5lc3NJZCIsInVybCIsIm5leHRVcmwiLCJwYXRobmFtZSIsInN0YXJ0c1dpdGgiLCJpbmNsdWRlcyIsIm1ldGhvZCIsIm5leHQiLCJzZXQiLCJjb25zb2xlIiwibWVzc2FnZSIsImNvbmZpZyIsIm1hdGNoZXIiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(middleware)/./src/middleware.js\n");

/***/ })

});